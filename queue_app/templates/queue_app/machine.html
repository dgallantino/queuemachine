{% extends "queue_app/base.html" %}
{% block javascript %}
	<script type="text/javascript">
			$('body').on('submit','.input_form', function(event){
				event.preventDefault();
				var id = $(this).attr('id');
				console.log(id);
				var data = {name:'ad'};
				var csrftoken = getCookie('csrftoken');
				console.log(JSON.stringify($(this).serializeFormJSON()));
				$.ajaxSetup({
			        beforeSend: function(xhr, settings) {
			            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
			                xhr.setRequestHeader("X-CSRFToken", csrftoken);
			            }
			        }
			    });
				$.ajax({
					url : "{% url "test_print" 9999 %}".replace('9999', id.toString()),
					type : "POST",
					dataType: 'json',
					contentType: 'application/json',
					data:JSON.stringify(data),
 					error : function(xhr){console.log(xhr.status);}
				})
				.done(print_ticket);
			});
			(function ($) {
			    $.fn.serializeFormJSON = function () {
			        var o = {};
			        var a = this.serializeArray();
			        $.each(a, function () {
			            if (o[this.name]) {
			                if (!o[this.name].push) {
			                    o[this.name] = [o[this.name]];
			                }
			                o[this.name].push(this.value || '');
			            } else {
			                o[this.name] = this.value || '';
			            }
			        });
			        return o;
			    };
			})(jQuery);
			
			function csrfSafeMethod(method) {
		        // these HTTP methods do not require CSRF protection
		        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		    }
			function getCookie(name) {
			    var cookieValue = null;
			    if (document.cookie && document.cookie !== '') {
			        var cookies = document.cookie.split(';');
			        for (var i = 0; i < cookies.length; i++) {
			            var cookie = jQuery.trim(cookies[i]);
			            // Does this cookie string begin with the name we want?
			            if (cookie.substring(0, name.length + 1) === (name + '=')) {
			                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
			                break;
			            }
			        }
			    }
			    return cookieValue;
			}
			function print_ticket(json){
				console.log(json);
{#				$('#queue_service').text(json.service.name);#}
{#				$('#qeueu_number').text(String(json.number));#}
{#				$('#queue_time').text(json.date_created);#}
				//window.print();
			}

	</script>
{% endblock %}

{% block content %}
	<div class="section_to_print">
		{% include 'queue_app/print_place_holder.html' %}
	</div>
	<div class="menu">
		<table class="content_table">
		{% for service in object_list %}
		<form class="input_form" id="{{ service.id }}">
			<tr class="content_tr">
				<td class="content_tr">
					<input type="hidden" name="pk" class="service_name" value="{{ service.id }}"/>
					<input type="hidden" name="service" class="service_desc" value="{{ service }}"/>
					<input type="submit" class="content_button" value="{{ service }}" />
				</td>
			</tr>
		</form>
		{% endfor %}
		</table>
	</div>
{% endblock %}
